version: '3.8'

# Single node deployment for development/testing
services:
  aeron-mq:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: aeron-mq
    hostname: aeron-mq
    environment:
      - NODE_ID=0
      - HOST=0.0.0.0
      - KAFKA_PORT=9092
      - DATA_DIR=/app/data
      - AERON_DIR=/dev/shm/aeron-mq
      - AUTO_CREATE_TOPICS=true
      - JAVA_OPTS=-Xms256m -Xmx1g -XX:+UseG1GC -XX:MaxGCPauseMillis=10
    ports:
      - "9092:9092"
    volumes:
      - aeron-mq-data:/app/data
      - aeron-mq-logs:/app/logs
    tmpfs:
      - /dev/shm:rw,nosuid,nodev,noexec,size=256m
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "9092"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 15s

volumes:
  aeron-mq-data:
  aeron-mq-logs:

